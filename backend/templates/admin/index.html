{% extends 'admin/master.html' %}

{% block head_css %}
  {{ super() }}
  <style>
    body {
      background-color: #1A1F26;
      color: #FFFFFF;
      font-family: 'SF Pro Text', sans-serif;
    }
    .link-card {
      transition: transform .2s;
    }
    .link-card:hover {
      transform: translateY(-4px);
    }
    #statsChartContainer {
      background: #2B313A;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
    }
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block body %}
  <div class="container-fluid py-4">
    <h2 style="text-align: center;">üëã –°–∞–ø –∞–¥–º–∏–Ω! –£–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã!</h2>
    <div class="row g-4 mt-3">
      <div class="col-md-4">
        <a href="{{ url_for('user.index_view') }}"
           class="card link-card text-white bg-primary text-center text-decoration-none p-3">
          <div class="card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
          <div class="card-value display-4">{{ users }}</div>
        </a>
      </div>
      <div class="col-md-4">
        <a href="{{ url_for('payment.index_view') }}"
           class="card link-card text-white bg-success text-center text-decoration-none p-3">
          <div class="card-title">–ü–ª–∞—Ç–µ–∂–µ–π</div>
          <div class="card-value display-4">{{ payments }}</div>
        </a>
      </div>
      <div class="col-md-4">
        <a href="{{ url_for('case.index_view') }}"
           class="card link-card text-white bg-info text-center text-decoration-none p-3">
          <div class="card-title">–ö–µ–π—Å–æ–≤</div>
          <div class="card-value display-4">{{ cases }}</div>
        </a>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <div id="statsChartContainer">
      <h5>–ù–æ–≤—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)</h5>
      <canvas id="statsChart" height="100"></canvas>
    </div>

    <footer class="text-center mt-5">
      <small>¬© {{ current_year }} CasinMain</small>
    </footer>
  </div>

  <script>
    // –ü–æ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏ —Ä–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
    fetch('/api/admin/stats_history')
      .then(res => res.json())
      .then(data => {
        const ctx = document.getElementById('statsChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [{
              label: '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
              data: data.counts,
              fill: true,
              borderColor: '#69AFFF',
              backgroundColor: 'rgba(105, 175, 255, 0.2)',
              tension: 0.4
            }]
          },
          options: {
            scales: {
              x: { grid: { display: false }, ticks: { color: '#DDD' } },
              y: { grid: { color: '#444' }, ticks: { color: '#DDD' } }
            },
            plugins: {
              legend: { labels: { color: '#FFF' } }
            }
          }
        });
      })
      .catch(console.error);
  </script>
{% endblock %}
